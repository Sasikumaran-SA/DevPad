{% extends "base.html" %}

{% block content %}
<div class="w-full max-w-4xl mx-auto bg-white rounded-lg shadow-md p-8">
    <h2 class="text-2xl font-bold text-center text-gray-800 mb-6">Create New Coding Problem</h2>
    
    <form action="" method="post" novalidate id="problem-form">
        {{ form.hidden_tag() }}
        
        <div class="mb-4">
            {{ form.title.label(class="block text-gray-700 text-sm font-bold mb-2") }}
            {{ form.title(class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500", size=32) }}
            {% for error in form.title.errors %}
            <span class="text-red-500 text-xs italic">{{ error }}</span>
            {% endfor %}
        </div>
        
        <div class="mb-6">
            {{ form.description.label(class="block text-gray-700 text-sm font-bold mb-2") }}
            {{ form.description(class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500", rows=10) }}
            {% for error in form.description.errors %}
            <span class="text-red-500 text-xs italic">{{ error }}</span>
            {% endfor %}
        </div>
        
        <div class="mb-6">
            {{ form.allowed_languages.label(class="block text-gray-700 text-sm font-bold mb-2") }}
            <div class="grid grid-cols-3 gap-2 p-4 border rounded-lg">
                {% for subfield in form.allowed_languages %}
                <div class="flex items-center">
                    {{ subfield(class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500") }}
                    {{ subfield.label(class="ml-2 text-gray-700") }}
                </div>
                {% endfor %}
            </div>
            {% for error in form.allowed_languages.errors %}
            <span class="text-red-500 text-xs italic">{{ error }}</span>
            {% endfor %}
        </div>

        <hr class="my-6">

        <h3 class="text-xl font-semibold text-gray-700 mb-4">Test Cases</h3>
        
        <div id="test-case-list" class="space-y-6">
            {% for test_case_form in form.test_cases %}
                {{ test_case_form.hidden_tag() }}
                <div class="p-4 border rounded-lg bg-gray-50 test-case-entry">
                    <h4 class="font-bold text-gray-600 mb-2">Test Case {{ loop.index }}</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            {{ test_case_form.public_input.label(class="block text-gray-700 text-sm font-bold mb-2") }}
                            {{ test_case_form.public_input(class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500") }}
                        </div>
                        <div>
                            {{ test_case_form.public_output.label(class="block text-gray-700 text-sm font-bold mb-2") }}
                            {{ test_case_form.public_output(class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500") }}
                        </div>
                        <div>
                            {{ test_case_form.hidden_input.label(class="block text-gray-700 text-sm font-bold mb-2") }}
                            {{ test_case_form.hidden_input(class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500") }}
                        </div>
                        <div>
                            {{ test_case_form.hidden_output.label(class="block text-gray-700 text-sm font-bold mb-2") }}
                            {{ test_case_form.hidden_output(class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500") }}
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
        
        <!-- Template for new test cases -->
        <template id="test-case-template">
            <div class="p-4 border rounded-lg bg-gray-50 test-case-entry">
                {{ form.test_cases.append_entry().hidden_tag() }}
                <h4 class="font-bold text-gray-600 mb-2">Test Case</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        {{ form.test_cases[0].public_input.label(class="block text-gray-700 text-sm font-bold mb-2") }}
                        {{ form.test_cases[0].public_input(class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500") }}
                    </div>
                    <div>
                        {{ form.test_cases[0].public_output.label(class="block text-gray-700 text-sm font-bold mb-2") }}
                        {{ form.test_cases[0].public_output(class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500") }}
                    </div>
                    <div>
                        {{ form.test_cases[0].hidden_input.label(class="block text-gray-700 text-sm font-bold mb-2") }}
                        {{ form.test_cases[0].hidden_input(class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500") }}
                    </div>
                    <div>
                        {{ form.test_cases[0].hidden_output.label(class="block text-gray-700 text-sm font-bold mb-2") }}
                        {{ form.test_cases[0].hidden_output(class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500") }}
                    </div>
                </div>
            </div>
        </template>

        <button type="button" id="add-test-case" class="mt-4 bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg">
            + Add Another Test Case
        </button>
        
        <div class="flex items-center justify-center mt-8">
            {{ form.submit(class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg focus:outline-none focus:shadow-outline cursor-pointer") }}
        </div>
    </form>
</div>

<script>
document.getElementById('add-test-case').addEventListener('click', function() {
    const template = document.getElementById('test-case-template');
    const clone = template.content.cloneNode(true);
    
    // Find how many test cases we already have to set the new index
    const count = document.querySelectorAll('.test-case-entry').length;
    
    // Update labels and names/ids
    clone.querySelector('h4').textContent = `Test Case ${count + 1}`;
    
    const fields = ['public_input', 'public_output', 'hidden_input', 'hidden_output', 'csrf_token'];
    fields.forEach(field => {
        const input = clone.querySelector(`[name$="${field}"]`);
        if (input) {
            input.name = `test_cases-${count}-${field}`;
            input.id = `test_cases-${count}-${field}`;
        }
        const label = clone.querySelector(`label[for$="${field}"]`);
        if (label) {
            label.htmlFor = `test_cases-${count}-${field}`;
        }
    });
    
    document.getElementById('test-case-list').appendChild(clone);
});
</script>
{% endblock %}
